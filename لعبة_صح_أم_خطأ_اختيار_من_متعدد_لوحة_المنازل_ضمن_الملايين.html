<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لعبة صح أم خطأ - لوحة المنازل ضمن الملايين</title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      text-align: center;
      direction: rtl;
      background: linear-gradient(to right, #e0f7fa, #e1bee7);
      margin: 0;
      padding: 20px;
    }
    #game { display: none; margin-top: 20px; }
    .question { font-size: 22px; margin: 20px; font-weight: bold; }
    .options { max-width: 720px; margin: 0 auto; }
    .options button {
      display: block; width: 100%; max-width: 340px;
      margin: 10px auto; padding: 10px 20px; border: none;
      border-radius: 10px; background-color: #4db6ac; color: white;
      font-size: 18px; cursor: pointer; transition: 0.2s;
    }
    .options button:hover { background-color: #00796b; }
    #feedback { font-size: 20px; margin: 15px; font-weight: bold; min-height: 28px; }
    #score { margin-top: 6px; font-weight: bold; }

    /* مؤقت دائري */
    #timerCircle {
      width: 140px; height: 140px; border-radius: 50%;
      border: 8px solid #4db6ac; margin: 20px auto;
      display: flex; align-items: center; justify-content: center;
      font-size: 26px; font-weight: bold; color: #00796b; position: relative;
    }
    #timerCircle::after {
      content: ""; position: absolute; inset: -8px; border-radius: 50%;
      border: 8px solid transparent; border-top-color: #6a1b9a;
      animation: spin 30s linear infinite;
    }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* شهادة */
    #certificate { display: none; }
    .cert-wrap { border: 5px solid #4db6ac; border-radius: 20px; padding: 30px; margin: 20px auto; width: min(90%, 800px); background: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
    .cert-wrap h2 { color: #6a1b9a; margin-top: 0; }
    .cert-actions button { padding: 10px 20px; font-size: 16px; margin: 10px; border: none; border-radius: 10px; background-color: #6a1b9a; color: white; cursor: pointer; }
    .cert-actions button.secondary { background: #4db6ac; }

    @media print {
      body * { visibility: hidden; }
      #printable, #printable * { visibility: visible; }
      #printable { position: fixed; left: 0; top: 0; width: 100%; }
    }
  </style>
</head>
<body>
  <h1>🎯 لوحة المنازل ضمن الملايين 🎯</h1>
  <div id="start">
    <p>أدخل اسمك للبدء باللعبة:</p>
    <input type="text" id="playerName" placeholder="اكتب اسمك هنا">
    <button onclick="startGame()">ابدأ</button>
  </div>

  <div id="game">
    <div id="timerCircle">30</div>
    <div class="question" id="question"></div>
    <div class="options" id="options"></div>
    <div id="feedback"></div>
    <div id="score">النقاط: 0</div>
  </div>

  <div id="certificate">
    <div id="printable" class="cert-wrap">
      <h2>🏆 شهادة شكر وتقدير 🏆</h2>
      <p id="certText" style="font-size:18px"></p>
      <p id="certDate" style="margin:8px 0;color:#555"></p>
    </div>
    <div class="cert-actions">
      <button class="secondary" id="btnPNG">تحميل كصورة (PNG)</button>
      <button id="btnPDF">تحميل كملف PDF</button>
      <button onclick="window.print()">طباعة الشهادة</button>
    </div>
  </div>

  <script>
    // === بيانات الأسئلة (10 أسئلة / 4 خيارات) ===
    const questions = [
      { q: "العدد 5,000,000 يقرأ خمسة ملايين.", options: ["صح", "خطأ", "لا أعلم", "0"], correct: 0 },
      { q: "العدد 3,450,000 يحتوي على 6 منازل.", options: ["صح", "خطأ", "ربما", "0"], correct: 1 },
      { q: "أصغر منزلة في الملايين هي المليون.", options: ["صح", "خطأ", "غير صحيح", "0"], correct: 0 },
      { q: "العدد 7,000,000 = سبعة ملايين.", options: ["صح", "خطأ", "غير متأكد", "0"], correct: 0 },
      { q: "في العدد 12,345,678 المنزلة الأولى هي الآحاد.", options: ["صح", "خطأ", "لا", "0"], correct: 0 },
      { q: "العدد 10,000,000 يسمى عشرة آلاف.", options: ["صح", "خطأ", "ربما", "0"], correct: 1 },
      { q: "العدد 1,000,000 يحتوي على 7 منازل.", options: ["صح", "خطأ", "0", "غير صحيح"], correct: 0 },
      { q: "في العدد 4,567,890 الرقم 4 في منزلة الملايين.", options: ["صح", "خطأ", "صحيح جزئياً", "0"], correct: 0 },
      { q: "العدد 9,876,543 أقل من عشرة ملايين.", options: ["صح", "خطأ", "ربما", "0"], correct: 0 },
      { q: "العدد 2,000,000 يقرأ مئتي ألف.", options: ["صح", "خطأ", "لا", "0"], correct: 1 },
    ];

    let currentQuestion = 0;
    let score = 0;
    let timer; let timeLeft = 30; const DURATION = 30;
    let playerName = "";

    // === مؤثرات صوتية عبر Web Audio API (HTML5) ===
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq = 880, dur = 0.2, type = 'sine', gain = 0.06) {
      const osc = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      osc.type = type; osc.frequency.value = freq; g.gain.value = gain;
      osc.connect(g).connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime + dur);
    }
    function playCorrect(){
      // جرس لطيف: نغمتان تصاعديتان
      playTone(740, 0.12, 'sine', 0.07);
      setTimeout(()=>playTone(988, 0.16, 'sine', 0.07), 120);
    }
    function playWrong(){
      // أزيز قصير: نغمتان تنازليتان
      playTone(220, 0.12, 'square', 0.07);
      setTimeout(()=>playTone(160, 0.18, 'square', 0.07), 120);
    }
    function playWin(){
      // فاصل قصير (فانفار): ثلاث نغمات
      playTone(523, 0.15, 'triangle', 0.08);
      setTimeout(()=>playTone(659, 0.15, 'triangle', 0.08), 170);
      setTimeout(()=>playTone(784, 0.3, 'triangle', 0.08), 340);
    }

    function startGame() {
      playerName = document.getElementById("playerName").value;
      if (playerName.trim() === "") { alert("من فضلك أدخل اسمك للبدء!"); return; }
      document.getElementById("start").style.display = "none";
      document.getElementById("game").style.display = "block";
      currentQuestion = 0; score = 0; document.getElementById('score').textContent = 'النقاط: 0';
      showQuestion();
    }

    function showQuestion() {
      if (currentQuestion >= questions.length) { endGame(); return; }
      document.getElementById("feedback").textContent = "";
      document.getElementById("question").textContent = `سؤال ${currentQuestion+1} من ${questions.length}: ` + questions[currentQuestion].q;
      const opts = document.getElementById("options"); opts.innerHTML = "";
      questions[currentQuestion].options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.textContent = opt; btn.onclick = () => checkAnswer(i);
        opts.appendChild(btn);
      });
      resetTimer();
    }

    function checkAnswer(i) {
      if (i === questions[currentQuestion].correct) {
        document.getElementById("feedback").textContent = "✅ ابدعت";
        playCorrect();
        score += 10; document.getElementById("score").textContent = "النقاط: " + score;
        clearInterval(timer);
        setTimeout(() => { currentQuestion++; showQuestion(); }, 800);
      } else {
        document.getElementById("feedback").textContent = "❌ حاول مرة اخرى";
        playWrong();
      }
    }

    function resetTimer() {
      clearInterval(timer);
      timeLeft = DURATION;
      const circle = document.getElementById("timerCircle");
      circle.textContent = timeLeft;
      circle.style.setProperty('--spinDur', DURATION+'s');
      timer = setInterval(() => {
        timeLeft--; circle.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timer);
          document.getElementById("feedback").textContent = "⏰ انتهى الوقت";
          setTimeout(() => { currentQuestion++; showQuestion(); }, 700);
        }
      }, 1000);
    }

    function endGame() {
      document.getElementById("game").style.display = "none";
      document.getElementById("certificate").style.display = "block";
      playWin();
      const performance = score >= 80 ? "🌟 ممتاز جداً" : (score >= 50 ? "👍 جيد جداً" : "🙂 تحتاج للمراجعة");
      document.getElementById("certText").textContent = `الطالب ${playerName} حصل على ${score} نقطة. ${performance}`;
      document.getElementById("certDate").textContent = 'التاريخ: ' + new Date().toLocaleDateString('ar-EG');
    }

    // === تنزيل الشهادة كصورة (PNG) ===
    document.getElementById('btnPNG').addEventListener('click', ()=>{
      const el = document.getElementById('printable');
      const svg = `<?xml version="1.0" encoding="utf-8"?>`+
      `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='900'>`+
      `<foreignObject width='100%' height='100%'>`+
      `<div xmlns='http://www.w3.org/1999/xhtml' style='font-family:Tahoma;padding:40px;background:#fff;box-sizing:border-box;width:1200px;height:900px;'>`+
      el.innerHTML+
      `</div></foreignObject></svg>`;
      const img = new Image();
      const blob = new Blob([svg], {type: 'image/svg+xml;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      img.onload = ()=>{
        const canvas = document.createElement('canvas'); canvas.width = 1200; canvas.height = 900;
        const ctx = canvas.getContext('2d'); ctx.fillStyle = '#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0); URL.revokeObjectURL(url);
        const png = canvas.toDataURL('image/png');
        const a = document.createElement('a'); a.href = png; a.download = `${playerName || 'certificate'}.png`; a.click();
      };
      img.src = url;
    });

    // === تنزيل الشهادة كملف PDF (فتح نافذة طباعة) ===
    document.getElementById('btnPDF').addEventListener('click', ()=>{
      const html = document.getElementById('printable').outerHTML;
      const win = window.open('', '_blank');
      win.document.write(`<!doctype html><html lang='ar' dir='rtl'><head><meta charset='utf-8'><title>شهادة</title>`+
        `<style>body{font-family:Tahoma;padding:20px} .cert-wrap{border:5px solid #4db6ac;border-radius:20px;padding:30px;margin:10px auto;width:90%;background:#fff}</style>`+
        `</head><body>${html}<script>window.onload=()=>window.print()<\/script></body></html>`);
      win.document.close();
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„Ø¹Ø¨Ø© ØµØ­ Ø£Ù… Ø®Ø·Ø£ - Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø§Ø²Ù„ Ø¶Ù…Ù† Ø§Ù„Ù…Ù„Ø§ÙŠÙŠÙ†</title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      text-align: center;
      direction: rtl;
      background: linear-gradient(to right, #e0f7fa, #e1bee7);
      margin: 0;
      padding: 20px;
    }
    #game { display: none; margin-top: 20px; }
    .question { font-size: 22px; margin: 20px; font-weight: bold; }
    .options { max-width: 720px; margin: 0 auto; }
    .options button {
      display: block; width: 100%; max-width: 340px;
      margin: 10px auto; padding: 10px 20px; border: none;
      border-radius: 10px; background-color: #4db6ac; color: white;
      font-size: 18px; cursor: pointer; transition: 0.2s;
    }
    .options button:hover { background-color: #00796b; }
    #feedback { font-size: 20px; margin: 15px; font-weight: bold; min-height: 28px; }
    #score { margin-top: 6px; font-weight: bold; }

    /* Ù…Ø¤Ù‚Øª Ø¯Ø§Ø¦Ø±ÙŠ */
    #timerCircle {
      width: 140px; height: 140px; border-radius: 50%;
      border: 8px solid #4db6ac; margin: 20px auto;
      display: flex; align-items: center; justify-content: center;
      font-size: 26px; font-weight: bold; color: #00796b; position: relative;
    }
    #timerCircle::after {
      content: ""; position: absolute; inset: -8px; border-radius: 50%;
      border: 8px solid transparent; border-top-color: #6a1b9a;
      animation: spin 30s linear infinite;
    }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Ø´Ù‡Ø§Ø¯Ø© */
    #certificate { display: none; }
    .cert-wrap { border: 5px solid #4db6ac; border-radius: 20px; padding: 30px; margin: 20px auto; width: min(90%, 800px); background: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
    .cert-wrap h2 { color: #6a1b9a; margin-top: 0; }
    .cert-actions button { padding: 10px 20px; font-size: 16px; margin: 10px; border: none; border-radius: 10px; background-color: #6a1b9a; color: white; cursor: pointer; }
    .cert-actions button.secondary { background: #4db6ac; }

    @media print {
      body * { visibility: hidden; }
      #printable, #printable * { visibility: visible; }
      #printable { position: fixed; left: 0; top: 0; width: 100%; }
    }
  </style>
</head>
<body>
  <h1>ğŸ¯ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø§Ø²Ù„ Ø¶Ù…Ù† Ø§Ù„Ù…Ù„Ø§ÙŠÙŠÙ† ğŸ¯</h1>
  <div id="start">
    <p>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©:</p>
    <input type="text" id="playerName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
    <button onclick="startGame()">Ø§Ø¨Ø¯Ø£</button>
  </div>

  <div id="game">
    <div id="timerCircle">30</div>
    <div class="question" id="question"></div>
    <div class="options" id="options"></div>
    <div id="feedback"></div>
    <div id="score">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
  </div>

  <div id="certificate">
    <div id="printable" class="cert-wrap">
      <h2>ğŸ† Ø´Ù‡Ø§Ø¯Ø© Ø´ÙƒØ± ÙˆØªÙ‚Ø¯ÙŠØ± ğŸ†</h2>
      <p id="certText" style="font-size:18px"></p>
      <p id="certDate" style="margin:8px 0;color:#555"></p>
    </div>
    <div class="cert-actions">
      <button class="secondary" id="btnPNG">ØªØ­Ù…ÙŠÙ„ ÙƒØµÙˆØ±Ø© (PNG)</button>
      <button id="btnPDF">ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù PDF</button>
      <button onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
    </div>
  </div>

  <script>
    // === Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (10 Ø£Ø³Ø¦Ù„Ø© / 4 Ø®ÙŠØ§Ø±Ø§Øª) ===
    const questions = [
      { q: "Ø§Ù„Ø¹Ø¯Ø¯ 5,000,000 ÙŠÙ‚Ø±Ø£ Ø®Ù…Ø³Ø© Ù…Ù„Ø§ÙŠÙŠÙ†.", options: ["ØµØ­", "Ø®Ø·Ø£", "Ù„Ø§ Ø£Ø¹Ù„Ù…", "0"], correct: 0 },
      { q: "Ø§Ù„Ø¹Ø¯Ø¯ 3,450,000 ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 6 Ù…Ù†Ø§Ø²Ù„.", options: ["ØµØ­", "Ø®Ø·Ø£", "Ø±Ø¨Ù…Ø§", "0"], correct: 1 },
      { q: "Ø£ØµØºØ± Ù…Ù†Ø²Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ø§ÙŠÙŠÙ† Ù‡ÙŠ Ø§Ù„Ù…Ù„ÙŠÙˆÙ†.", options: ["ØµØ­", "Ø®Ø·Ø£", "ØºÙŠØ± ØµØ­ÙŠØ­", "0"], correct: 0 },
      { q: "Ø§Ù„Ø¹Ø¯Ø¯ 7,000,000 = Ø³Ø¨Ø¹Ø© Ù…Ù„Ø§ÙŠÙŠÙ†.", options: ["ØµØ­", "Ø®Ø·Ø£", "ØºÙŠØ± Ù…ØªØ£ÙƒØ¯", "0"], correct: 0 },
      { q: "ÙÙŠ Ø§Ù„Ø¹Ø¯Ø¯ 12,345,678 Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡ÙŠ Ø§Ù„Ø¢Ø­Ø§Ø¯.", options: ["ØµØ­", "Ø®Ø·Ø£", "Ù„Ø§", "0"], correct: 0 },
      { q: "Ø§Ù„Ø¹Ø¯Ø¯ 10,000,000 ÙŠØ³Ù…Ù‰ Ø¹Ø´Ø±Ø© Ø¢Ù„Ø§Ù.", options: ["ØµØ­", "Ø®Ø·Ø£", "Ø±Ø¨Ù…Ø§", "0"], correct: 1 },
      { q: "Ø§Ù„Ø¹Ø¯Ø¯ 1,000,000 ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 7 Ù…Ù†Ø§Ø²Ù„.", options: ["ØµØ­", "Ø®Ø·Ø£", "0", "ØºÙŠØ± ØµØ­ÙŠØ­"], correct: 0 },
      { q: "ÙÙŠ Ø§Ù„Ø¹Ø¯Ø¯ 4,567,890 Ø§Ù„Ø±Ù‚Ù… 4 ÙÙŠ Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ù…Ù„Ø§ÙŠÙŠÙ†.", options: ["ØµØ­", "Ø®Ø·Ø£", "ØµØ­ÙŠØ­ Ø¬Ø²Ø¦ÙŠØ§Ù‹", "0"], correct: 0 },
      { q: "Ø§Ù„Ø¹Ø¯Ø¯ 9,876,543 Ø£Ù‚Ù„ Ù…Ù† Ø¹Ø´Ø±Ø© Ù…Ù„Ø§ÙŠÙŠÙ†.", options: ["ØµØ­", "Ø®Ø·Ø£", "Ø±Ø¨Ù…Ø§", "0"], correct: 0 },
      { q: "Ø§Ù„Ø¹Ø¯Ø¯ 2,000,000 ÙŠÙ‚Ø±Ø£ Ù…Ø¦ØªÙŠ Ø£Ù„Ù.", options: ["ØµØ­", "Ø®Ø·Ø£", "Ù„Ø§", "0"], correct: 1 },
    ];

    let currentQuestion = 0;
    let score = 0;
    let timer; let timeLeft = 30; const DURATION = 30;
    let playerName = "";

    // === Ù…Ø¤Ø«Ø±Ø§Øª ØµÙˆØªÙŠØ© Ø¹Ø¨Ø± Web Audio API (HTML5) ===
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq = 880, dur = 0.2, type = 'sine', gain = 0.06) {
      const osc = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      osc.type = type; osc.frequency.value = freq; g.gain.value = gain;
      osc.connect(g).connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime + dur);
    }
    function playCorrect(){
      // Ø¬Ø±Ø³ Ù„Ø·ÙŠÙ: Ù†ØºÙ…ØªØ§Ù† ØªØµØ§Ø¹Ø¯ÙŠØªØ§Ù†
      playTone(740, 0.12, 'sine', 0.07);
      setTimeout(()=>playTone(988, 0.16, 'sine', 0.07), 120);
    }
    function playWrong(){
      // Ø£Ø²ÙŠØ² Ù‚ØµÙŠØ±: Ù†ØºÙ…ØªØ§Ù† ØªÙ†Ø§Ø²Ù„ÙŠØªØ§Ù†
      playTone(220, 0.12, 'square', 0.07);
      setTimeout(()=>playTone(160, 0.18, 'square', 0.07), 120);
    }
    function playWin(){
      // ÙØ§ØµÙ„ Ù‚ØµÙŠØ± (ÙØ§Ù†ÙØ§Ø±): Ø«Ù„Ø§Ø« Ù†ØºÙ…Ø§Øª
      playTone(523, 0.15, 'triangle', 0.08);
      setTimeout(()=>playTone(659, 0.15, 'triangle', 0.08), 170);
      setTimeout(()=>playTone(784, 0.3, 'triangle', 0.08), 340);
    }

    function startGame() {
      playerName = document.getElementById("playerName").value;
      if (playerName.trim() === "") { alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø¨Ø¯Ø¡!"); return; }
      document.getElementById("start").style.display = "none";
      document.getElementById("game").style.display = "block";
      currentQuestion = 0; score = 0; document.getElementById('score').textContent = 'Ø§Ù„Ù†Ù‚Ø§Ø·: 0';
      showQuestion();
    }

    function showQuestion() {
      if (currentQuestion >= questions.length) { endGame(); return; }
      document.getElementById("feedback").textContent = "";
      document.getElementById("question").textContent = `Ø³Ø¤Ø§Ù„ ${currentQuestion+1} Ù…Ù† ${questions.length}: ` + questions[currentQuestion].q;
      const opts = document.getElementById("options"); opts.innerHTML = "";
      questions[currentQuestion].options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.textContent = opt; btn.onclick = () => checkAnswer(i);
        opts.appendChild(btn);
      });
      resetTimer();
    }

    function checkAnswer(i) {
      if (i === questions[currentQuestion].correct) {
        document.getElementById("feedback").textContent = "âœ… Ø§Ø¨Ø¯Ø¹Øª";
        playCorrect();
        score += 10; document.getElementById("score").textContent = "Ø§Ù„Ù†Ù‚Ø§Ø·: " + score;
        clearInterval(timer);
        setTimeout(() => { currentQuestion++; showQuestion(); }, 800);
      } else {
        document.getElementById("feedback").textContent = "âŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø§Ø®Ø±Ù‰";
        playWrong();
      }
    }

    function resetTimer() {
      clearInterval(timer);
      timeLeft = DURATION;
      const circle = document.getElementById("timerCircle");
      circle.textContent = timeLeft;
      circle.style.setProperty('--spinDur', DURATION+'s');
      timer = setInterval(() => {
        timeLeft--; circle.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timer);
          document.getElementById("feedback").textContent = "â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª";
          setTimeout(() => { currentQuestion++; showQuestion(); }, 700);
        }
      }, 1000);
    }

    function endGame() {
      document.getElementById("game").style.display = "none";
      document.getElementById("certificate").style.display = "block";
      playWin();
      const performance = score >= 80 ? "ğŸŒŸ Ù…Ù…ØªØ§Ø² Ø¬Ø¯Ø§Ù‹" : (score >= 50 ? "ğŸ‘ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹" : "ğŸ™‚ ØªØ­ØªØ§Ø¬ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©");
      document.getElementById("certText").textContent = `Ø§Ù„Ø·Ø§Ù„Ø¨ ${playerName} Ø­ØµÙ„ Ø¹Ù„Ù‰ ${score} Ù†Ù‚Ø·Ø©. ${performance}`;
      document.getElementById("certDate").textContent = 'Ø§Ù„ØªØ§Ø±ÙŠØ®: ' + new Date().toLocaleDateString('ar-EG');
    }

    // === ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙƒØµÙˆØ±Ø© (PNG) ===
    document.getElementById('btnPNG').addEventListener('click', ()=>{
      const el = document.getElementById('printable');
      const svg = `<?xml version="1.0" encoding="utf-8"?>`+
      `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='900'>`+
      `<foreignObject width='100%' height='100%'>`+
      `<div xmlns='http://www.w3.org/1999/xhtml' style='font-family:Tahoma;padding:40px;background:#fff;box-sizing:border-box;width:1200px;height:900px;'>`+
      el.innerHTML+
      `</div></foreignObject></svg>`;
      const img = new Image();
      const blob = new Blob([svg], {type: 'image/svg+xml;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      img.onload = ()=>{
        const canvas = document.createElement('canvas'); canvas.width = 1200; canvas.height = 900;
        const ctx = canvas.getContext('2d'); ctx.fillStyle = '#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0); URL.revokeObjectURL(url);
        const png = canvas.toDataURL('image/png');
        const a = document.createElement('a'); a.href = png; a.download = `${playerName || 'certificate'}.png`; a.click();
      };
      img.src = url;
    });

    // === ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙƒÙ…Ù„Ù PDF (ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø©) ===
    document.getElementById('btnPDF').addEventListener('click', ()=>{
      const html = document.getElementById('printable').outerHTML;
      const win = window.open('', '_blank');
      win.document.write(`<!doctype html><html lang='ar' dir='rtl'><head><meta charset='utf-8'><title>Ø´Ù‡Ø§Ø¯Ø©</title>`+
        `<style>body{font-family:Tahoma;padding:20px} .cert-wrap{border:5px solid #4db6ac;border-radius:20px;padding:30px;margin:10px auto;width:90%;background:#fff}</style>`+
        `</head><body>${html}<script>window.onload=()=>window.print()<\/script></body></html>`);
      win.document.close();
    });
  </script>
</body>
</html>
